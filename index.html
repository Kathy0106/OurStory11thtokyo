<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Êù±‰∫¨Ê´ªËä±‰πãÊóÖ 2026</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Zen Maru Gothic', sans-serif;
            background-color: #FFF0F5; /* Ê∑∫Ê´ªËâ≤ËÉåÊôØ */
            overscroll-behavior-y: none; /* Èò≤Ê≠¢ÊâãÊ©ü‰∏ãÊãâÂà∑Êñ∞ */
        }
        /* Èö±ËóèÊç≤Ëª∏‰ΩÜ‰øùÁïôÂäüËÉΩ */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
        }
        /* Âç°ÁâáÈô∞ÂΩ± */
        .soft-shadow {
            box-shadow: 0 4px 20px rgba(219, 112, 147, 0.15);
        }
    </style>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        sakura: {
                            100: '#FFF0F5',
                            200: '#FDE2E4',
                            300: '#FADADD',
                            500: '#FFB7C5',
                            600: '#DB7093', // Ê∑±Á≤â
                        },
                        wisteria: {
                            300: '#D8B4FE',
                            500: '#A855F7',
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="text-slate-700 h-screen w-screen overflow-hidden flex flex-col">

    <div id="app" class="h-full flex flex-col relative">

        <div class="relative h-[250px] flex-shrink-0 bg-cover bg-center transition-all duration-500"
             style="background-image: url('./header.png'), url('./header.jpg');">
            
            <div class="absolute inset-0 bg-gradient-to-b from-transparent to-black/30"></div>
            
            <div class="absolute bottom-8 right-4 flex space-x-3 z-20">
                <button @click="currentTab = 'itinerary'" :class="tabClass('itinerary')">
                    <i class="fa-solid fa-map-location-dot text-lg"></i>
                </button>
                <button @click="currentTab = 'info'" :class="tabClass('info')">
                    <i class="fa-solid fa-circle-info text-lg"></i>
                </button>
                <button @click="currentTab = 'shopping'" :class="tabClass('shopping')">
                    <i class="fa-solid fa-basket-shopping text-lg"></i>
                </button>
                <button @click="currentTab = 'expenses'" :class="tabClass('expenses')">
                    <i class="fa-solid fa-yen-sign text-lg"></i>
                </button>
            </div>
            
            <div class="absolute bottom-10 left-6 text-white text-shadow">
                <h1 class="text-2xl font-bold tracking-widest">TOKYO 2026</h1>
                <p class="text-sm opacity-90">Sakura & Pre-wedding</p>
            </div>
        </div>

        <div class="flex-1 bg-sakura-100 rounded-t-[30px] -mt-6 relative z-10 overflow-hidden flex flex-col shadow-[0_-5px_20px_rgba(0,0,0,0.1)]">
            
            <div class="flex-1 overflow-y-auto no-scrollbar p-5 pb-24">

                <div v-if="currentTab === 'itinerary'">
                    
                    <div class="flex space-x-3 overflow-x-auto no-scrollbar mb-6 py-2">
                        <div v-for="(day, index) in days" :key="index" 
                             @click="selectedDayIndex = index"
                             class="flex-shrink-0 flex flex-col items-center justify-center w-16 h-20 rounded-2xl transition-all duration-300 snap-center cursor-pointer border border-white/50"
                             :class="selectedDayIndex === index ? 'bg-sakura-600 text-white shadow-lg scale-105' : 'bg-white text-gray-400'">
                            <span class="text-xs font-bold uppercase">{{ day.weekday }}</span>
                            <span class="text-xl font-bold">{{ day.date }}</span>
                            <span class="text-[10px] opacity-80">Day {{ index + 1 }}</span>
                        </div>
                    </div>

                    <div class="bg-gradient-to-r from-blue-100 to-sakura-200 rounded-2xl p-4 mb-12 flex items-center justify-between shadow-sm text-slate-600">
                        <div>
                            <div class="text-xs opacity-70 flex items-center gap-1">
                                <i class="fa-solid fa-location-dot"></i> {{ weather.city_name }}
                            </div>
                            <div class="text-2xl font-bold">{{ weather.temp }}¬∞C <span class="text-sm font-normal text-gray-500">È´îÊÑü {{ weather.feels_like }}¬∞C</span></div>
                        </div>
                        <i :class="['fa-solid', weather.icon, 'text-4xl text-yellow-400 drop-shadow-sm']"></i>
                    </div>

                    <div class="space-y-0 relative">
                        <div class="absolute left-[22px] top-4 bottom-4 w-0.5 bg-sakura-300 opacity-50 z-0"></div>

                        <div v-for="(item, idx) in currentDayItinerary" :key="item.id" class="relative pl-12 pb-14 group">
                            
                            <div v-if="idx > 0" class="absolute -top-9 left-12 right-0 flex items-center text-xs text-sakura-600 mb-2 z-50">
                                <span class="bg-sakura-100 px-2 py-0.5 rounded-full border border-sakura-200 flex items-center gap-1 shadow-sm">
                                    <i :class="getTransportIcon(item.transportType)"></i>
                                    {{ item.travelTime || '15 min' }}
                                </span>
                            </div>

                            <div class="absolute left-0 top-4 w-11 h-11 rounded-full bg-white border-4 border-sakura-100 flex items-center justify-center z-10 shadow-sm text-sakura-600 font-bold text-xs">
                                {{ item.time.split(':')[0] }}
                            </div>

                            <div class="bg-white rounded-2xl p-4 soft-shadow relative overflow-hidden transition-all active:scale-95"
                                 :class="{'border-l-4 border-wisteria-300': item.category === 'flight', 'border-l-4 border-sakura-500': item.category !== 'flight'}">
                                
                                <div @click="openMap(item.location)">
                                    <div class="flex justify-between items-start mb-1">
                                        <div class="text-xs font-bold text-sakura-600 uppercase tracking-wider">{{ item.time }} ‚Ä¢ {{ itemCategoryName(item.category) }}</div>
                                        <div class="flex gap-2">
                                            <button @click.stop="moveItem(idx, -1)" v-if="idx > 0" class="text-gray-300 hover:text-sakura-600"><i class="fa-solid fa-chevron-up"></i></button>
                                            <button @click.stop="moveItem(idx, 1)" v-if="idx < currentDayItinerary.length - 1" class="text-gray-300 hover:text-sakura-600"><i class="fa-solid fa-chevron-down"></i></button>
                                            <button @click.stop="deleteItem(item.id)" class="text-gray-300 hover:text-red-400"><i class="fa-solid fa-trash"></i></button>
                                        </div>
                                    </div>
                                    
                                    <h3 class="text-lg font-bold mb-1 leading-tight">{{ item.title }}</h3>
                                    
                                    <div class="text-sm text-gray-500 mb-2 flex items-start gap-1" v-if="item.desc">
                                        <i class="fa-regular fa-note-sticky mt-0.5 text-xs"></i>
                                        <span class="whitespace-pre-line">{{ item.desc }}</span>
                                    </div>

                                    <div class="flex flex-wrap gap-2 mt-2">
                                        <span v-if="item.category === 'food'" class="text-[10px] bg-orange-50 text-orange-500 px-2 py-1 rounded-md">
                                            <i class="fa-solid fa-utensils mr-1"></i>ÁæéÈ£ü
                                        </span>
                                        <span v-if="item.location" class="text-[10px] bg-blue-50 text-blue-500 px-2 py-1 rounded-md">
                                            <i class="fa-solid fa-location-arrow mr-1"></i>Â∞éËà™
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div v-if="currentDayItinerary.length === 0" class="text-center text-gray-400 py-10">
                            <i class="fa-solid fa-calendar-plus text-4xl mb-3 text-sakura-200"></i>
                            <p>ÈªûÊìäÂè≥‰∏ãËßíÊñ∞Â¢ûË°åÁ®ã</p>
                        </div>
                    </div>
                </div>

                <div v-if="currentTab === 'info'" class="space-y-6">
                    
                    <div class="bg-white rounded-2xl p-5 soft-shadow">
                        <h3 class="font-bold text-sakura-600 mb-3"><i class="fa-solid fa-coins mr-2"></i>ÂåØÁéáÊèõÁÆó (Âç≥ÊôÇ/Âõ∫ÂÆö)</h3>
                        <div class="flex items-center gap-2 mb-2">
                            <div class="flex-1 bg-gray-50 rounded-lg p-2 flex items-center">
                                <span class="text-gray-400 mr-2 text-sm">JPY</span>
                                <input type="number" v-model="calcJpy" @input="convert('jpy')" class="w-full bg-transparent outline-none font-bold text-lg" placeholder="0">
                            </div>
                            <i class="fa-solid fa-arrow-right-arrow-left text-gray-300"></i>
                            <div class="flex-1 bg-gray-50 rounded-lg p-2 flex items-center">
                                <span class="text-gray-400 mr-2 text-sm">HKD</span>
                                <input type="number" v-model="calcHkd" @input="convert('hkd')" class="w-full bg-transparent outline-none font-bold text-lg" placeholder="0">
                            </div>
                        </div>
                        <div class="text-right text-xs text-gray-400">ÂåØÁéá: {{ exchangeRate }} (JPY -> HKD)</div>
                    </div>

                    <div class="bg-white rounded-2xl p-0 soft-shadow overflow-hidden">
                        <div class="bg-sakura-200 p-3 text-sakura-600 font-bold flex justify-between">
                            <span><i class="fa-solid fa-plane mr-2"></i>Ëà™Áè≠Ë≥áË®ä</span>
                        </div>
                        <div class="p-5">
                            <div class="mb-6 relative">
                                <div class="flex justify-between items-end mb-2">
                                    <div class="text-center">
                                        <div class="text-3xl font-bold text-slate-700">HKG</div>
                                        <div class="text-xs text-gray-400">È¶ôÊ∏Ø</div>
                                    </div>
                                    <i class="fa-solid fa-plane text-sakura-400 mb-2"></i>
                                    <div class="text-center">
                                        <div class="text-3xl font-bold text-slate-700">NRT</div>
                                        <div class="text-xs text-gray-400">ÊàêÁî∞</div>
                                    </div>
                                </div>
                                <div class="flex justify-between text-sm font-bold bg-gray-50 p-2 rounded-lg mb-2">
                                    <span>CX524</span>
                                    <span>01:00 Ëµ∑È£õ</span>
                                    <span>06:40 ÊäµÈÅî</span>
                                </div>
                                <a href="https://www.google.com/search?q=CX524+flight+status" target="_blank" class="block w-full text-center py-2 rounded-lg border border-sakura-300 text-sakura-600 text-sm font-bold hover:bg-sakura-50 transition-colors">
                                    <i class="fa-solid fa-wifi mr-1"></i> Êü•ÁúãÂç≥ÊôÇÁãÄÊÖã
                                </a>
                            </div>
                             <div class="relative pt-4 border-t border-dashed border-gray-200">
                                <div class="flex justify-between items-end mb-2">
                                    <div class="text-center">
                                        <div class="text-3xl font-bold text-slate-700">NRT</div>
                                        <div class="text-xs text-gray-400">ÊàêÁî∞</div>
                                    </div>
                                    <i class="fa-solid fa-plane text-sakura-400 mb-2"></i>
                                    <div class="text-center">
                                        <div class="text-3xl font-bold text-slate-700">HKG</div>
                                        <div class="text-xs text-gray-400">È¶ôÊ∏Ø</div>
                                    </div>
                                </div>
                                <div class="flex justify-between text-sm font-bold bg-gray-50 p-2 rounded-lg mb-2">
                                    <span>CX501</span>
                                    <span>ÂõûÁ®ãÁè≠Ê¨°</span>
                                </div>
                                <a href="https://www.google.com/search?q=CX501+flight+status" target="_blank" class="block w-full text-center py-2 rounded-lg border border-sakura-300 text-sakura-600 text-sm font-bold hover:bg-sakura-50 transition-colors">
                                    <i class="fa-solid fa-wifi mr-1"></i> Êü•ÁúãÂç≥ÊôÇÁãÄÊÖã
                                </a>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-2xl p-0 soft-shadow overflow-hidden">
                        <div class="bg-blue-100 p-3 text-blue-600 font-bold flex justify-between">
                            <span><i class="fa-solid fa-car mr-2"></i>ÁßüËªäË≥áË®ä</span>
                        </div>
                        <div class="p-5 space-y-3">
                            <div>
                                <div class="text-xs text-gray-400">È†êÁ¥ÑËôüÁ¢º</div>
                                <div class="text-xl font-bold text-slate-700 tracking-wider">98147748300</div>
                                <div class="text-sm text-blue-500 font-bold mt-1">Toyota Rent a Car</div>
                            </div>
                            <div class="flex gap-4 border-t border-gray-100 pt-3">
                                <div class="flex-1">
                                    <div class="text-xs text-gray-400">ÂèñËªä (Ê∞¥Â§©ÂÆÆ)</div>
                                    <div class="font-bold">4/20 <span class="text-blue-500">09:30</span></div>
                                </div>
                                <div class="flex-1">
                                    <div class="text-xs text-gray-400">ÈÇÑËªä (Ê∞¥Â§©ÂÆÆ)</div>
                                    <div class="font-bold">4/22 <span class="text-blue-500">20:00</span></div>
                                </div>
                            </div>
                            <div class="bg-gray-50 p-3 rounded-lg text-sm text-gray-500">
                                <i class="fa-solid fa-location-dot mr-1"></i> Ê∞¥Â§©ÂÆÆ T-CAT Â∫ó
                            </div>
                            <button @click="openMap('Toyota Rent a Car T-CAT')" class="w-full bg-blue-500 text-white py-3 rounded-xl font-bold shadow-md active:scale-95 transition-transform">
                                <i class="fa-solid fa-location-arrow mr-2"></i>Â∞éËà™ÂéªÂèñËªä
                            </button>
                        </div>
                    </div>

                    <div class="space-y-4">
                        <h3 class="font-bold text-gray-500 ml-1">‰ΩèÂÆøÂàóË°®</h3>
                        <div v-for="hotel in hotels" :key="hotel.name" class="bg-white rounded-2xl p-4 soft-shadow flex items-center gap-4" @click="openMap(hotel.name)">
                            <div class="w-12 h-12 rounded-full bg-wisteria-300 flex items-center justify-center text-white text-xl">
                                <i class="fa-solid fa-bed"></i>
                            </div>
                            <div class="flex-1">
                                <h4 class="font-bold text-sm">{{ hotel.name }}</h4>
                                <p class="text-xs text-gray-400 mt-1">{{ hotel.dates }}</p>
                            </div>
                            <i class="fa-solid fa-chevron-right text-gray-300"></i>
                        </div>
                    </div>
                </div>

                <div v-if="currentTab === 'shopping'">
                    <div class="grid grid-cols-2 gap-4">
                        <div v-for="item in shoppingList" :key="item.id" class="bg-white rounded-xl p-3 soft-shadow relative group">
                            <button @click="removeShoppingItem(item.id)" class="absolute top-2 right-2 bg-white/80 rounded-full w-6 h-6 flex items-center justify-center text-red-400 shadow-sm z-10"><i class="fa-solid fa-xmark"></i></button>
                            <div class="aspect-square bg-gray-100 rounded-lg mb-2 overflow-hidden bg-cover bg-center" 
                                 :style="item.image ? `background-image: url(${item.image})` : ''">
                                 <div v-if="!item.image" class="w-full h-full flex items-center justify-center text-gray-300">
                                    <i class="fa-solid fa-image"></i>
                                 </div>
                            </div>
                            <h4 class="font-bold text-sm text-center truncate">{{ item.name }}</h4>
                        </div>
                    </div>
                    <div v-if="shoppingList.length === 0" class="text-center text-gray-400 mt-10">
                        <p>Â∞öÁÑ°Ë≥ºÁâ©Ê∏ÖÂñÆ</p>
                    </div>
                </div>

                <div v-if="currentTab === 'expenses'">
                    <div class="bg-sakura-600 text-white rounded-2xl p-6 mb-6 shadow-lg text-center">
                        <div class="text-sm opacity-80 mb-1">Á∏ΩËä±Ë≤ª</div>
                        <div class="text-4xl font-bold">¬• {{ totalExpenses.toLocaleString() }}</div>
                    </div>

                    <div class="space-y-3">
                        <div v-for="exp in expenses" :key="exp.id" class="bg-white rounded-xl p-4 soft-shadow flex justify-between items-center">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center text-gray-500">
                                    <i :class="getCategoryIcon(exp.category)"></i>
                                </div>
                                <div>
                                    <div class="font-bold text-sm">{{ exp.name }}</div>
                                    <div class="text-xs text-gray-400">{{ exp.date }} ‚Ä¢ {{ exp.payment }}</div>
                                </div>
                            </div>
                            <div class="font-bold text-sakura-600">¬•{{ parseInt(exp.amount).toLocaleString() }}</div>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <button @click="openAddModal" class="absolute bottom-6 right-6 w-14 h-14 bg-sakura-600 text-white rounded-full shadow-lg flex items-center justify-center text-2xl z-50 hover:bg-sakura-500 transition-colors">
            <i class="fa-solid fa-plus"></i>
        </button>

        <div v-if="showModal" class="fixed inset-0 z-50 flex items-end sm:items-center justify-center bg-black/50 backdrop-blur-sm" @click.self="showModal = false">
            <div class="bg-white w-full sm:w-96 rounded-t-3xl sm:rounded-3xl p-6 shadow-2xl animate-slide-up">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold text-sakura-600">
                        {{ currentTab === 'itinerary' ? 'Êñ∞Â¢ûË°åÁ®ã' : currentTab === 'shopping' ? 'Êñ∞Â¢ûË≥ºÁâ©' : 'Ë®ò‰∏ÄÁ≠Ü' }}
                    </h3>
                    <button @click="showModal = false" class="text-gray-400"><i class="fa-solid fa-xmark text-xl"></i></button>
                </div>

                <div v-if="currentTab === 'itinerary'" class="space-y-4">
                    <input v-model="newItem.title" type="text" placeholder="Ë°åÁ®ãÂêçÁ®±" class="w-full p-3 bg-gray-50 rounded-xl border-none outline-none focus:ring-2 focus:ring-sakura-300">
                    <div class="flex gap-2">
                        <input v-model="newItem.time" type="time" class="w-1/3 p-3 bg-gray-50 rounded-xl outline-none">
                        <select v-model="newItem.category" class="w-2/3 p-3 bg-gray-50 rounded-xl outline-none">
                            <option value="sightseeing">ÊôØÈªû</option>
                            <option value="food">ÁæéÈ£ü</option>
                            <option value="shopping">Ë≥ºÁâ©</option>
                            <option value="transport">‰∫§ÈÄö</option>
                            <option value="hotel">‰ΩèÂÆø</option>
                            <option value="ticket">ÈñÄÁ•®/Pass</option>
                        </select>
                    </div>
                     <div class="bg-gray-50 p-3 rounded-xl">
                        <label class="text-xs text-gray-400 block mb-1">ÂâçÂæÄÊ≠§ËôïÁöÑ‰∫§ÈÄö</label>
                        <div class="flex gap-2 mb-2">
                            <select v-model="newItem.transportType" class="flex-1 p-2 bg-white rounded-lg text-sm">
                                <option value="walk">Ê≠•Ë°å</option>
                                <option value="train">ÈõªËªä/Âú∞Èêµ</option>
                                <option value="car">ÈñãËªä/ÁöÑÂ£´</option>
                                <option value="bus">Â∑¥Â£´</option>
                            </select>
                            <input v-model="newItem.travelTime" placeholder="‰æãÂ¶Ç: 15 min" class="flex-1 p-2 bg-white rounded-lg text-sm">
                        </div>
                    </div>
                    <textarea v-model="newItem.desc" placeholder="ÂÇôË®ª / ÁâπËâ≤ / Âú∞ÂùÄ" class="w-full p-3 bg-gray-50 rounded-xl border-none outline-none h-24"></textarea>
                    <input v-model="newItem.location" type="text" placeholder="Google Maps ÊêúÂ∞ãÈóúÈçµÂ≠ó" class="w-full p-3 bg-gray-50 rounded-xl border-none outline-none text-sm">
                </div>

                <div v-if="currentTab === 'shopping'" class="space-y-4">
                    <input v-model="newShopping.name" type="text" placeholder="ÂïÜÂìÅÂêçÁ®±" class="w-full p-3 bg-gray-50 rounded-xl outline-none">
                    <div class="relative w-full h-32 bg-gray-50 rounded-xl border-2 border-dashed border-gray-200 flex flex-col items-center justify-center text-gray-400 cursor-pointer hover:bg-gray-100">
                        <input type="file" @change="handleImageUpload" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer">
                        <i class="fa-solid fa-camera text-2xl mb-1"></i>
                        <span class="text-xs">ÈªûÊìä‰∏äÂÇ≥ÂúñÁâá</span>
                    </div>
                </div>

                <div v-if="currentTab === 'expenses'" class="space-y-4">
                    <input v-model="newExpense.name" type="text" placeholder="È†ÖÁõÆÂêçÁ®±" class="w-full p-3 bg-gray-50 rounded-xl outline-none">
                    <div class="flex gap-2">
                        <input v-model="newExpense.amount" type="number" placeholder="ÈáëÈ°ç (JPY)" class="flex-1 p-3 bg-gray-50 rounded-xl outline-none">
                        <select v-model="newExpense.category" class="w-1/3 p-3 bg-gray-50 rounded-xl outline-none">
                            <option value="food">È£≤È£ü</option>
                            <option value="transport">‰∫§ÈÄö</option>
                            <option value="shopping">Ë≥ºÁâ©</option>
                            <option value="ticket">ÈñÄÁ•®</option>
                            <option value="other">ÂÖ∂‰ªñ</option>
                        </select>
                    </div>
                    <div class="flex gap-2">
                         <select v-model="newExpense.payment" class="w-full p-3 bg-gray-50 rounded-xl outline-none">
                            <option value="ÁèæÈáë">ÁèæÈáë</option>
                            <option value="‰ø°Áî®Âç°">‰ø°Áî®Âç°</option>
                            <option value="Suica/IC">Suica/IC</option>
                        </select>
                    </div>
                </div>

                <button @click="confirmAdd" class="w-full bg-sakura-600 text-white font-bold py-4 rounded-xl mt-6 shadow-lg hover:bg-sakura-500 transition-all">Á¢∫Ë™çÊñ∞Â¢û</button>
            </div>
        </div>

    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    currentTab: 'itinerary',
                    selectedDayIndex: 0,
                    showModal: false,
                    exchangeRate: 0.053, // È†êË®≠ HKD ÂåØÁéá
                    calcJpy: '',
                    calcHkd: '', 
                    
                    weather: { 
                        city_name: 'Êù±‰∫¨, Êó•Êú¨', // È†êË®≠
                        temp: '--', 
                        feels_like: '--', 
                        icon: 'fa-spinner fa-spin' 
                    },
                    // API Key Â∑≤‰øùÁïô
                    apiKey: 'cc2dab2806da14aec6dab2ed8260a1c4',

                    // Êó•ÊúüË®≠ÂÆö
                    days: [
                        { weekday: 'Sat', date: '4/18' },
                        { weekday: 'Sun', date: '4/19' },
                        { weekday: 'Mon', date: '4/20' },
                        { weekday: 'Tue', date: '4/21' },
                        { weekday: 'Wed', date: '4/22' },
                        { weekday: 'Thu', date: '4/23' },
                        { weekday: 'Fri', date: '4/24' },
                        { weekday: 'Sat', date: '4/25' }
                    ],

                    hotels: [
                        { name: 'VIA INN PRIME Êó•Êú¨Ê©ã‰∫∫ÂΩ¢Áî∫', dates: '4/18 - 4/20' },
                        { name: 'Toyoko Inn ‰Ωê‰πÖÂπ≥Á´ôÊ∑∫ÈñìÂè£', dates: '4/20 - 4/22' },
                        { name: 'ÂÖ´ÈáçÁø†Êù±‰∫¨ÈÖíÂ∫ó', dates: '4/22 - 4/25' }
                    ],

                    // Ë°åÁ®ãË≥áÊñô
                    itineraryData: [
                        // Day 1: 4/18
                        [
                            { id: 1, time: '06:40', title: 'ÊäµÈÅîÊàêÁî∞Ê©üÂ†¥ (NRT)', category: 'flight', desc: 'Âà∞Â§ßÂ†ÇÊ©ôËâ≤Ê´ÉÂè∞Ë≤∑È£õÂéª T-CAT', transportType: 'flight' },
                            { id: 2, time: '07:45', title: 'Ê©üÂ†¥ -> T-CAT', category: 'transport', desc: 'Âà©Êú®Ê¥•Â∑¥Â£´Ôºå4ÂÄãÂñºÂØÑËâô', transportType: 'bus', travelTime: '75 min' },
                            { id: 3, time: '09:00', title: 'T-CAT -> ÈÖíÂ∫ó', category: 'transport', desc: 'Êê≠ÁöÑÂ£´ÔºåÁõ¥ÈÅî VIA INN ÈñÄÂè£', location: 'VIA INN PRIME Êó•Êú¨Ê©ã‰∫∫ÂΩ¢Áî∫', transportType: 'car', travelTime: '10 min' },
                            { id: 4, time: '11:00', title: 'Âà©‰πÖÁâõËàå (ÂçàÈ§ê)', category: 'food', desc: '‰∏äÈáé Parco_ya 6FÔºåÊé®Ëñ¶„ÄåÊ•µ„ÄçÂÆöÈ£ü', location: 'Âà©‰πÖÁâõËàå ‰∏äÈáé', transportType: 'train', travelTime: '30 min' },
                            { id: 5, time: '13:00', title: 'Ê†πÊ¥•Á•ûÁ§æ (ÊùúÈµëËä±Á•≠)', category: 'sightseeing', desc: 'Êê≠ÈÉΩÁáüÂ∑¥Â£´ [‰∏ä58]', location: 'Ê†πÊ¥•Á•ûÁ§æ', transportType: 'bus', travelTime: '20 min' },
                            { id: 6, time: '15:30', title: 'Ê∑∫ËçâÊï£Ê≠•', category: 'sightseeing', desc: 'Èõ∑ÈñÄ/‰ª≤Ë¶ã‰∏ñÈÄöÔºåÊ†πÊ¥•Êê≠Â∑¥Â£´ [‰∏ä26]', location: 'Ê∑∫ËçâÂØ∫', transportType: 'bus', travelTime: '25 min' },
                            { id: 7, time: '17:00', title: 'Á±≥‰πÖÊú¨Â∫ó (ÁôæÂπ¥ÁâõÈçã)', category: 'food', desc: 'Â£ΩÂñúÁáíÔºåÂè™Êî∂ÁèæÈáëÔºåÈúÄÊéíÈöä', location: 'Á±≥‰πÖÊú¨Â∫ó', transportType: 'walk', travelTime: '10 min' }
                        ],
                        // Day 2: 4/19
                        [
                            { id: 21, time: '09:30', title: 'ÈæúÊà∂Â§©Á•ûÁ§æ (Á¥´Ëó§Ëä±)', category: 'sightseeing', desc: 'Ê∞¥Â§©ÂÆÆÂâç->Èå¶Á≥∏Áî∫ÔºåË°å15ÂàÜÈêò', location: 'ÈæúÊà∂Â§©Á•ûÁ§æ', transportType: 'train', travelTime: '30 min' },
                            { id: 22, time: '12:30', title: 'Â±±Á¨ë„Åµ (ÂçàÈ§ê)', category: 'food', desc: 'Ë°®ÂèÉÈÅìÂ∫óÔºåShabu ShabuÔºåÂ∑≤È†êÁ¥Ñ', location: 'Â±±Á¨ë„Åµ Ë°®ÂèÉÈÅì', transportType: 'train', travelTime: '45 min' },
                            { id: 23, time: '14:30', title: 'Harakado (ÂéüËßí)', category: 'sightseeing', desc: '7FÂ±ãÈ†ÇËä±ÂúíÂÖçË≤ªÂÖ•Â†¥', location: 'Harakado', transportType: 'walk', travelTime: '5 min' },
                            { id: 24, time: '19:00', title: 'Áâõ„Åã„Å§„ÇÇ„Å®Êùë (ÁÇ∏ÁâõÊéí)', category: 'food', desc: 'ÊæÄË∞∑ÂàÜÂ∫óÔºåÈúÄÊéíÈöä', location: 'Áâõ„Åã„Å§„ÇÇ„Å®Êùë ÊæÄË∞∑', transportType: 'walk', travelTime: '20 min' }
                        ],
                        // Day 3: 4/20
                        [
                             { id: 31, time: '09:00', title: 'Check-out & Ë°åÂéªÂèñËªä', category: 'other', desc: 'Ë°åÂéª T-CAT', transportType: 'walk' },
                             { id: 32, time: '09:30', title: 'ÂèñËªä (Toyota Rent a Car)', category: 'transport', desc: 'T-CAT Â∫óÔºå‰∫àÁ¥ÑÁï™Âè∑: 98147748300', location: 'Toyota Rent a Car T-CAT', transportType: 'walk' },
                             { id: 33, time: '10:30', title: '‰∏âËä≥ PA (‰ºëÊÅØÁ´ô)', category: 'other', desc: 'MapCode: 5 506 583*55', location: '‰∏âËä≥PA', transportType: 'car', travelTime: '60 min' },
                             { id: 34, time: '13:00', title: 'Ëºï‰∫ïÊæ§ÂçàÈ§ê', category: 'food', desc: 'Â∑ù‰∏äÂ∫µ Êàñ ÊùëÊ∞ëÈ£üÂ†Ç', location: 'Ëºï‰∫ïÊæ§ ÊòüÈáéÂçÄ', transportType: 'car', travelTime: '90 min' },
                             { id: 35, time: '14:30', title: 'Ëºï‰∫ïÊæ§ Outlet', category: 'shopping', desc: 'MapCode: 292 677 245*55 (Ê≥ä P7)', location: 'Ëºï‰∫ïÊæ§ÁéãÂ≠êË≥ºÁâ©Âª£Â†¥', transportType: 'car', travelTime: '20 min' },
                             { id: 36, time: '18:00', title: 'Check-in Toyoko Inn', category: 'hotel', desc: 'Ê≥äËªä: Âª∫Ë≠∞Áõ¥Êé•Ê≥äÈÖíÂ∫ó2Êôö', location: 'Toyoko Inn ‰Ωê‰πÖÂπ≥Á´ôÊ∑∫ÈñìÂè£', transportType: 'car', travelTime: '40 min' },
                             { id: 37, time: '20:00', title: 'ÊöñÊöÆÊãâÈ∫µ', category: 'food', desc: 'Aeon Mall ‰Ωê‰πÖÂπ≥ 2Ê®ì', location: 'Aeon Mall ‰Ωê‰πÖÂπ≥', transportType: 'walk', travelTime: '8 min' }
                        ],
                        // Day 4: 4/21 Pre-wedding
                        [
                            { id: 41, time: '08:00', title: 'Pre-wedding Â©öÁ¥óÊãçÊîù', category: 'other', desc: 'ÂÖ®Êó•ÊãçÊîùÔºåËá™ÈßïÁßªÂãï', transportType: 'car' },
                            { id: 42, time: '19:00', title: 'Ëºï‰∫ïÊæ§ÊôöÈ§ê', category: 'food', desc: 'Â∑ù‰∏äÂ∫µ Êàñ ÊùëÊ∞ëÈ£üÂ†Ç', location: 'Ëºï‰∫ïÊæ§', transportType: 'car' }
                        ],
                         // Day 5: 4/22
                         [
                            { id: 51, time: '10:00', title: 'ÁôΩÁµ≤ÁÄëÂ∏É', category: 'sightseeing', desc: 'MapCode: 292 701 645*63', location: 'ÁôΩÁµ≤ÁÄëÂ∏É Ëºï‰∫ïÊæ§', transportType: 'car' },
                            { id: 52, time: '11:00', title: '„Çç„Åê‰∫≠ (Rogotei) ÁáíËÇâ', category: 'food', desc: 'Âª∫Ë≠∞ Book!', location: 'Rogotei Karuizawa', transportType: 'car' },
                            { id: 53, time: '12:30', title: 'ËàäËºï‰∫ïÊæ§ÈäÄÂ∫ßÈÄö', category: 'sightseeing', desc: 'ÊéÉË°ó„ÄÅÂ∏É‰∏Å', location: 'ËàäËºï‰∫ïÊæ§ÈäÄÂ∫ßÈÄö', transportType: 'car' },
                            { id: 54, time: '14:00', title: 'Ê©´Â∑ù SA (ÈáúÈ£Ø)', category: 'food', desc: 'ÂøÖÈ£ü: Â≥†„ÅÆÈáú„ÇÅ„Åó‰æøÁï∂', location: 'Ê©´Â∑ùSA', transportType: 'car' },
                            { id: 55, time: '17:00', title: 'Êù±‰∫¨ÈÇÑËªä', category: 'transport', desc: 'T-CAT B1 ÂÅúËªäÂ†¥ÔºåÂÖ•ÊªøÊ≤π', location: 'T-CAT', transportType: 'car' },
                            { id: 56, time: '20:45', title: 'Â£ΩÂè∏ÈÉé ÂÖ´ÈáçÊ¥≤', category: 'food', desc: 'ÂÖ´ÈáçÊ¥≤Âú∞‰∏ãË°ó Âçó1Ëôü', location: 'Â£ΩÂè∏ÈÉé ÂÖ´ÈáçÊ¥≤Âú∞‰∏ãË°ó', transportType: 'walk' }
                        ],
                        // Day 6: 4/23 Disney Sea (Updated)
                         [
                            { id: 61, time: '06:45', title: 'Êó©Ëµ∑Âá∫Áôº (ÊîªÈô∑ Fantasy Springs)', category: 'transport', desc: 'Ë°åÂéª„ÄåÂÖ´‰∏ÅÂ†Ä„ÄçÊê≠ JR ‰∫¨ËëâÁ∑ö (15ÂàÜÈêò)\nÁõÆÊ®ô 07:30 Âà∞ÈÅîÈñÄÂè£', location: 'ÂÖ´‰∏ÅÂ†ÄÁ´ô', transportType: 'train', travelTime: '45 min' },
                            { id: 62, time: '07:30', title: 'Âà∞ÈÅîÈñÄÂè£ÊéíÈöä', category: 'other', desc: 'Ê∫ñÂÇôÂ•Ω AppÔºåÁ¢∫‰øù LoginÔºåÂêåË°åÈ£õ Scan ÂÖ•Âêå‰∏ÄÈÉ®Ê©ü', location: 'Tokyo Disney Sea', transportType: 'walk', travelTime: '60 min' },
                            { id: 63, time: '08:30', title: 'ÂÖ•Âúí & Êê∂ Pass (ÈóúÈçµÊôÇÂàª!)', category: 'ticket', desc: '1. ÊäΩ Standby Pass (È¶ñÈÅ∏ Frozen)\n2. Ë≤∑ DPA (Â¶ÇÂÖçË≤ªÂ∑≤ÁÑ°)', location: 'Fantasy Springs', transportType: 'walk' },
                            { id: 64, time: '09:00', title: 'Ê≠£ÂºèÈÅäÁé©', category: 'sightseeing', desc: 'Áõ°ÊÉÖ‰∫´ÂèóËø™Â£´Â∞ºÊµ∑Ê¥ã üè∞', location: 'Tokyo Disney Sea', transportType: 'walk' }
                        ],
                        // Day 7: 4/24 Ë±êÊ¥≤
                         [
                            { id: 71, time: '09:30', title: 'ÂâçÂæÄË±êÊ¥≤', category: 'transport', desc: 'ÁöÑÂ£´Áõ¥Âéª (Á¥Ñ ¬•2000)', location: 'Ë±êÊ¥≤Â∏ÇÂ†¥', transportType: 'car' },
                            { id: 72, time: '10:00', title: 'Â§ßÂíåÂ£ΩÂè∏', category: 'food', desc: '‰∏çÂèØÈ†êÁ¥ÑÔºåÈúÄÊéíÈöä', location: 'Â§ßÂíåÂ£ΩÂè∏ Ë±êÊ¥≤', transportType: 'walk' },
                            { id: 73, time: '13:30', title: 'TeamLab Planets', category: 'sightseeing', desc: 'Êñ∞Ë±êÊ¥≤Á´ôÊóÅ', location: 'teamLab Planets TOKYO', transportType: 'walk' },
                            { id: 74, time: '18:30', title: 'ÈäÄÂ∫ß ÁØù Êú¨Â∫ó', category: 'food', desc: 'ÈõûÁôΩÊπØÊãâÈ∫µ', location: 'ÈäÄÂ∫ß ÁØù Êú¨Â∫ó', transportType: 'train' }
                        ],
                        // Day 8: 4/25
                         [
                            { id: 81, time: '10:30', title: 'Êù±‰∫¨‰∏ÄÁï™Ë°ó', category: 'shopping', desc: 'Character Street', location: 'Êù±‰∫¨‰∏ÄÁï™Ë°ó', transportType: 'car' },
                            { id: 82, time: '12:00', title: 'Manten Sushi', category: 'food', desc: '‰∏∏‰πãÂÖß Brick Square B1F', location: 'Manten Sushi Marunouchi', transportType: 'walk' },
                            { id: 83, time: '14:30', title: 'T-CAT ÂØÑË°åÊùé', category: 'transport', desc: '3Ê®ìË≤∑È£õ & ÂØÑËâô', location: 'T-CAT', transportType: 'car' },
                            { id: 84, time: '14:45', title: 'Â∑¥Â£´ -> Ê©üÂ†¥', category: 'transport', desc: 'CX501 ÂõûÁ®ã', location: 'ÊàêÁî∞Ê©üÂ†¥', transportType: 'bus' }
                        ]
                    ],

                    shoppingList: [],
                    expenses: [],

                    // Êñ∞Â¢ûÈ†ÖÁõÆÊö´Â≠ò
                    newItem: { title: '', time: '', category: 'sightseeing', desc: '', location: '', transportType: 'train', travelTime: '' },
                    newShopping: { name: '', image: null },
                    newExpense: { name: '', amount: '', category: 'food', date: '', payment: 'ÁèæÈáë' }
                }
            },
            computed: {
                currentDayItinerary() {
                    return this.itineraryData[this.selectedDayIndex] || [];
                },
                totalExpenses() {
                    return this.expenses.reduce((sum, item) => sum + parseInt(item.amount || 0), 0);
                }
            },
            // Êñ∞Â¢û: Áõ£ËÅΩ selectedDayIndexÔºåÁï∂Êó•ÊúüÊîπËÆäÊôÇÔºåËá™ÂãïÊõ¥Êñ∞Â§©Ê∞£
            watch: {
                selectedDayIndex(newVal) {
                    this.fetchWeather();
                }
            },
            mounted() {
                this.fetchWeather();
                this.fetchRates(); 

                const savedShopping = localStorage.getItem('shoppingList');
                if (savedShopping) this.shoppingList = JSON.parse(savedShopping);
                
                const savedExpenses = localStorage.getItem('expenses');
                if (savedExpenses) this.expenses = JSON.parse(savedExpenses);
                
                const savedItinerary = localStorage.getItem('itineraryData');
                if (savedItinerary) this.itineraryData = JSON.parse(savedItinerary);
            },
            methods: {
                // ‰øÆÊîπ: Â§©Ê∞£ÂäüËÉΩÊîØÊè¥ÂãïÊÖãÂú∞ÂçÄ
                fetchWeather() {
                    // Ê†πÊìöÊó•ÊúüÊ±∫ÂÆöÂú∞ÂçÄ
                    // index 2,3,4 (Day 3-5: 4/20-22) È°ØÁ§∫ Ëºï‰∫ïÊæ§
                    const isKaruizawa = this.selectedDayIndex >= 2 && this.selectedDayIndex <= 4;
                    const cityQuery = isKaruizawa ? 'Karuizawa,JP' : 'Tokyo,JP';
                    const cityName = isKaruizawa ? 'Ëºï‰∫ïÊæ§, Êó•Êú¨' : 'Êù±‰∫¨, Êó•Êú¨';
                    
                    // Êõ¥Êñ∞‰ªãÈù¢‰∏äÁöÑÂú∞ÂçÄÂêçÁ®±
                    this.weather.city_name = cityName;

                    const fallbackWeather = { temp: 18, feels_like: 16, icon: 'fa-cloud-sun' };

                    fetch(`https://api.openweathermap.org/data/2.5/weather?q=${cityQuery}&units=metric&lang=zh_tw&appid=${this.apiKey}`)
                    .then(res => {
                        if (!res.ok) throw new Error("API Key ÂèØËÉΩÊú™ÁîüÊïà");
                        return res.json();
                    })
                    .then(data => {
                        this.weather.temp = Math.round(data.main.temp);
                        this.weather.feels_like = Math.round(data.main.feels_like);
                        const weatherId = data.weather[0].id;
                        if (weatherId === 800) this.weather.icon = 'fa-sun';
                        else if (weatherId >= 801) this.weather.icon = 'fa-cloud';
                        else if (weatherId >= 500) this.weather.icon = 'fa-cloud-rain';
                        else if (weatherId >= 600) this.weather.icon = 'fa-snowflake';
                        else this.weather.icon = 'fa-cloud-sun';
                    })
                    .catch(err => {
                        console.error("Â§©Ê∞£ËºâÂÖ•Â§±ÊïóÔºå‰ΩøÁî®È†êË®≠ÂÄº:", err);
                        this.weather.temp = fallbackWeather.temp;
                        this.weather.feels_like = fallbackWeather.feels_like;
                        this.weather.icon = fallbackWeather.icon;
                    });
                },
                fetchRates() {
                    fetch('https://api.exchangerate-api.com/v4/latest/JPY')
                    .then(res => res.json())
                    .then(data => {
                        if (data.rates && data.rates.HKD) {
                            this.exchangeRate = data.rates.HKD; 
                        }
                    })
                    .catch(err => {
                        console.log("ÂåØÁéá API Â§±ÊïóÔºå‰ΩøÁî®È†êË®≠ÂÄº 0.053");
                        this.exchangeRate = 0.053; 
                    });
                },
                tabClass(tab) {
                    return this.currentTab === tab 
                        ? 'bg-sakura-600 text-white w-12 h-12 rounded-full shadow-lg flex items-center justify-center transition-all transform scale-110' 
                        : 'bg-white/90 text-sakura-600 w-10 h-10 rounded-full shadow flex items-center justify-center hover:bg-white transition-all';
                },
                itemCategoryName(cat) {
                    const map = { sightseeing: 'ÊôØÈªû', food: 'ÁæéÈ£ü', shopping: 'Ë≥ºÁâ©', transport: '‰∫§ÈÄö', hotel: '‰ΩèÂÆø', flight: 'Ëà™Áè≠', ticket: 'ÈñÄÁ•®', other: 'ÂÖ∂‰ªñ' };
                    return map[cat] || 'ÂÖ∂‰ªñ';
                },
                getCategoryIcon(cat) {
                    const map = { food: 'fa-utensils', transport: 'fa-train', shopping: 'fa-bag-shopping', ticket: 'fa-ticket', other: 'fa-circle-question' };
                    return `fa-solid ${map[cat] || 'fa-circle'}`;
                },
                getTransportIcon(type) {
                    const map = { walk: 'fa-person-walking', train: 'fa-train-subway', car: 'fa-car', bus: 'fa-bus', flight: 'fa-plane' };
                    return `fa-solid ${map[type] || 'fa-arrow-right'}`;
                },
                openMap(location) {
                    if (location) {
                        window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(location)}`, '_blank');
                    }
                },
                convert(type) {
                    if (type === 'jpy') {
                        this.calcHkd = (this.calcJpy * this.exchangeRate).toFixed(2);
                    } else {
                        this.calcJpy = (this.calcHkd / this.exchangeRate).toFixed(0);
                    }
                },
                openAddModal() {
                    this.newItem = { title: '', time: '12:00', category: 'sightseeing', desc: '', location: '', transportType: 'train', travelTime: '' };
                    this.newShopping = { name: '', image: null };
                    this.newExpense = { name: '', amount: '', category: 'food', date: this.days[this.selectedDayIndex].date, payment: 'ÁèæÈáë' };
                    this.showModal = true;
                },
                handleImageUpload(event) {
                    const file = event.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            this.newShopping.image = e.target.result;
                        };
                        reader.readAsDataURL(file);
                    }
                },
                confirmAdd() {
                    if (this.currentTab === 'itinerary') {
                        if (!this.newItem.title) return;
                        const item = { ...this.newItem, id: Date.now() };
                        this.itineraryData[this.selectedDayIndex].push(item);
                        this.itineraryData[this.selectedDayIndex].sort((a, b) => a.time.localeCompare(b.time));
                        localStorage.setItem('itineraryData', JSON.stringify(this.itineraryData));
                    } else if (this.currentTab === 'shopping') {
                        if (!this.newShopping.name) return;
                        this.shoppingList.push({ ...this.newShopping, id: Date.now() });
                        localStorage.setItem('shoppingList', JSON.stringify(this.shoppingList));
                    } else if (this.currentTab === 'expenses') {
                        if (!this.newExpense.amount) return;
                        this.expenses.push({ ...this.newExpense, id: Date.now() });
                        localStorage.setItem('expenses', JSON.stringify(this.expenses));
                    }
                    this.showModal = false;
                },
                deleteItem(id) {
                    if(confirm('Á¢∫ÂÆöË¶ÅÂà™Èô§ÈÄôÂÄãË°åÁ®ãÂóéÔºü')) {
                        const idx = this.itineraryData[this.selectedDayIndex].findIndex(i => i.id === id);
                        if (idx !== -1) {
                            this.itineraryData[this.selectedDayIndex].splice(idx, 1);
                            localStorage.setItem('itineraryData', JSON.stringify(this.itineraryData));
                        }
                    }
                },
                removeShoppingItem(id) {
                     this.shoppingList = this.shoppingList.filter(i => i.id !== id);
                     localStorage.setItem('shoppingList', JSON.stringify(this.shoppingList));
                },
                moveItem(index, direction) {
                    const list = this.itineraryData[this.selectedDayIndex];
                    const targetIndex = index + direction;
                    if (targetIndex >= 0 && targetIndex < list.length) {
                        const temp = list[index];
                        list[index] = list[targetIndex];
                        list[targetIndex] = temp;
                        localStorage.setItem('itineraryData', JSON.stringify(this.itineraryData));
                    }
                }
            }
        }).mount('#app');
    </script>
    <style>
        /* Animation */
        @keyframes slide-up {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }
        .animate-slide-up {
            animation: slide-up 0.3s ease-out;
        }
        .text-shadow {
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }
    </style>
</body>
</html>
